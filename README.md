# PF2e Threat Tracker for Foundry VTT

**PF2e Threat Tracker** is a Foundry VTT module that tracks **threat** generated by player characters and ally NPCs in the **Pathfinder 2e** system. It maintains a threat table for each enemy, showing which characters have generated the most attention. The module displays a floating panel listing each enemy and its top threat-holders, helping Game Masters monitor aggro during combat.

> This module is compatible with **Foundry VTT v13+**. It may load on v12, but v12-specific bugs will not be addressed.

---

## üß© Features

- **Threat Tracking**  
  Automatically tracks threat from common actions (damage, healing, taunts, etc.) for each character against each enemy.

- **Threat Panel**  
  A floating UI panel lists every enemy token in the scene along with their top threat-generators. It updates in real time during combat and shows the top 3 sources of threat per enemy.

- **Trait & Vulnerability Configuration** *(WIP)*  
  Configure trait-based multipliers and vulnerabilities through a GUI. For example, if an enemy is vulnerable to fire, attacks with the `fire` trait will generate more threat. These settings dynamically affect threat calculation.

- **Sequencer Visual Effects** *(Optional)*  
  If the [Sequencer](https://github.com/fantasycalendar/FoundryVTT-Sequencer) module is installed, PF2e Threat Tracker can trigger animations or effects on tokens when threat changes or thresholds are reached.  
  Example: a glowing effect when a new top-threat character overtakes another.

- **Persistent Storage**  
  Each enemy's threat table is stored using Foundry's flags system. This allows data to persist across scenes or sessions.

---

## üöÄ Installation

1. Copy the **Manifest URL** for PF2e Threat Tracker (must end in `module.json`).
2. In Foundry VTT, go to **Add-on Modules ‚Üí Install Module**.
3. Paste the URL into the **Manifest URL** field and click **Install**.
4. Enable the module in **Manage Modules**, then click **Save Module Settings**.

---

## ‚öîÔ∏è Usage

- **Opening the Threat Panel**  
  The Threat Tracker panel opens automatically at the start of combat. It can also be toggled manually if needed.

- **Monitoring Threat**  
  During combat, any time a PC or allied token deals damage, heals, or uses a defined taunt or ability, their threat value increases against the relevant enemy. The panel displays the **top 3 threat-holders** per enemy so the GM knows who is most likely to be targeted.

- **Configuring Traits & Vulnerabilities** *(WIP)*  
  Open the trait configuration menu from the module settings or use the button in the floating panel. You can search traits and modify threat multipliers dynamically (e.g. "fire" attacks do √ó1.5 threat to creatures with the `plant` trait).

- **Sequencer Effects**  
  If Sequencer is available, the module will play a brief visual effect when threat is generated or when the top-threat character changes. These effects can be enabled/disabled in the module settings.

---

## ‚öôÔ∏è Configuration

Go to **Settings ‚Üí Module Settings ‚Üí PF2e Threat Tracker** to adjust:

1. **Trait / Vulnerability Editor**  (Not yet fully implemented)
   Opens a GUI to configure threat multipliers per trait and weaknesses per trait tag.

2. **Panel Options**  (Not yet fully implemented)
   Control the position. Panel size and number of top entries shown on the threat panel is WIP.

3. **Sequencer Integration**  
   Toggle on/off the use of Sequencer visual effects.

4. **Logging & Thresholds**  (Not yet fully implemented)
   Set thresholds or verbosity for when effects or logs are triggered.

---

## üõ†Ô∏è Roadmap

### ‚úÖ Partially Implemented

- **Trait Multipliers (basic)**  
  Trait-based threat scaling is supported, but coverage and logic will expand.

- **Vulnerability Settings**  
  Creatures can be weak or resistant to specific traits. More nuanced logic (e.g. stacking or resistance negation) is in development.

### üîß In Progress

- **Improved Trait Editor UI**  
  Enhance layout, usability, and trait grouping.

- **Threat Panel Styling**  
  Improve responsiveness and allow theme/custom color support.

- **Accessibility Options**  
  Add hotkeys and UI affordances for faster toggling or panel movement.

### üí° Future Ideas

- **Distance-Based Threat Modifiers**  
  Scale threat based on how far the attacker is from the enemy (relative to their speed).

- **Extra VFX Options**  
  Use Sequencer to flash icons or mark the top-threat character more clearly.

- **More Threat Triggers**  
  Expand beyond damage/healing to include auras, saves, special actions, etc.

- **Styles for the threat table**
  Maybe a menu like FFXIV where all the combat participants shows up in the table ([like this old module](https://foundryvtt.com/packages/mmo-hud)) and if enemy token is selected shows bars of who is having the attention on below a minitoken image/name text.
<img width="268" height="380" alt="image" src="https://github.com/user-attachments/assets/817fbed5-0595-4592-a864-2308ca83d0dc" />
  Image from [this reddit post](https://www.reddit.com/r/ffxiv/comments/zg72ta/til_that_if_your_current_health_is_less_than_your)


---

### Credits

- Wasp for creating Sequencer
- Chasarooni for being a wondeful person (he made the sequencer macro!!!)
- TheJoester for almost making me cry
- The whole pathfinder community ‚ô•
- Foundry Team for making me use its program since v9 (2021 lmao)

## üôå Contributing

Contributions and feedback are welcome!  
Feel free to open issues or pull requests via GitHub.
